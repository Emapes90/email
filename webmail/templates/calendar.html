{% extends "base.html" %} {% block title %}Calendar â€” {{ app_name }}{% endblock
%} {% block body %}
<div class="app-layout">
  {% include "_sidebar.html" %}

  <div class="main-content">
    <div class="calendar-page">
      <div class="calendar-header">
        <div class="calendar-nav">
          <button
            class="btn btn-secondary btn-sm"
            onclick="ProMail.calendar.prevMonth()"
          >
            <i class="fas fa-chevron-left"></i>
          </button>
          <h2 id="calendarMonth"></h2>
          <button
            class="btn btn-secondary btn-sm"
            onclick="ProMail.calendar.nextMonth()"
          >
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
        <div class="d-flex gap-sm">
          <button
            class="btn btn-secondary btn-sm"
            onclick="ProMail.calendar.goToday()"
          >
            <i class="fas fa-calendar-day"></i> Today
          </button>
          <button
            class="btn btn-primary btn-sm"
            onclick="
              ProMail.calendar.openDay(
                new Date().getFullYear(),
                new Date().getMonth(),
                new Date().getDate(),
              )
            "
          >
            <i class="fas fa-plus"></i> New Event
          </button>
        </div>
      </div>

      <div class="calendar-grid" id="calendarGrid">
        <!-- Rendered by JS -->
      </div>
    </div>
  </div>
</div>

<!-- Event Modal -->
<div class="modal-overlay" id="eventModal">
  <div class="modal">
    <div class="modal-header">
      <h3>
        <i
          class="fas fa-calendar-plus"
          style="color: var(--accent); margin-right: 0.5rem"
        ></i>
        Event
      </h3>
      <button
        class="btn btn-ghost btn-icon"
        onclick="ProMail.closeModal('eventModal')"
      >
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="modal-body">
      <input type="hidden" id="eventId" />
      <div class="form-group">
        <label>Title *</label>
        <input
          type="text"
          id="eventTitle"
          class="form-control"
          placeholder="Event title"
          required
        />
      </div>
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem">
        <div class="form-group">
          <label>Start *</label>
          <input
            type="datetime-local"
            id="eventStart"
            class="form-control"
            required
          />
        </div>
        <div class="form-group">
          <label>End *</label>
          <input
            type="datetime-local"
            id="eventEnd"
            class="form-control"
            required
          />
        </div>
      </div>
      <div class="form-group">
        <label>Location</label>
        <div class="form-control-icon">
          <input
            type="text"
            id="eventLocation"
            class="form-control"
            placeholder="Add location"
          />
          <i class="fas fa-map-marker-alt"></i>
        </div>
      </div>
      <div class="form-group">
        <label>Description</label>
        <textarea
          id="eventDescription"
          class="form-control"
          rows="3"
          placeholder="Add details..."
        ></textarea>
      </div>
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem">
        <div class="form-group">
          <label>Color</label>
          <input
            type="color"
            id="eventColor"
            class="form-control"
            value="#6366f1"
            style="height: 40px; padding: 4px"
          />
        </div>
        <div class="form-group" style="display: flex; align-items: flex-end">
          <div class="form-check">
            <input type="checkbox" id="eventAllDay" />
            <label for="eventAllDay">All day event</label>
          </div>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button
        class="btn btn-danger btn-sm"
        onclick="ProMail.calendar.deleteEvent()"
        id="eventDeleteBtn"
        style="margin-right: auto; display: none"
      >
        <i class="fas fa-trash-alt"></i> Delete
      </button>
      <button
        class="btn btn-secondary"
        onclick="ProMail.closeModal('eventModal')"
      >
        Cancel
      </button>
      <button class="btn btn-primary" onclick="ProMail.calendar.saveEvent()">
        <i class="fas fa-check"></i> Save
      </button>
    </div>
  </div>
</div>

{% endblock %} {% block scripts %}
<script>
  document.addEventListener("DOMContentLoaded", () => {
    ProMail.calendar.init();

    // Show/hide delete button
    const eventIdInput = document.getElementById("eventId");
    const deleteBtn = document.getElementById("eventDeleteBtn");
    const observer = new MutationObserver(() => {
      deleteBtn.style.display = eventIdInput.value ? "" : "none";
    });
    observer.observe(eventIdInput, {
      attributes: true,
      attributeFilter: ["value"],
    });

    // Also check on modal open
    const origOpen = ProMail.openModal;
    ProMail.openModal = function (id) {
      origOpen.call(this, id);
      if (id === "eventModal") {
        deleteBtn.style.display = eventIdInput.value ? "" : "none";
      }
    };
  });
</script>
{% endblock %}
